---
title: "Reproducible analysis workflows"
subtitle: |
  A short introduction into reproducible analysis tools: Rmarkdown, Github and others  
  \bigskip
  ![](figures/logo.png){width=1in}  
author: "Cornelius Hennch"
date: '`r format(Sys.Date(), "%d.%m.%Y")`'
output: 
  beamer_presentation:
    theme: "Boadilla"
    colortheme: "dove"
    fonttheme: "structurebold"
    dev: cairo_pdf
    latex_engine: "xelatex"
    keep_tex: yes
bibliography: repro.bib
# csl: american-medical-association.csl
mainfont: Cambria
classoption: "aspectratio=169"
fontsize: 12pt
header-includes: 
  - \usepackage{fontawesome5}
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.align = "center")
```

# Introduction

## Why do we need reproducible data analysis?

\centering

"Reproducibility is the ability to obtain identical results from the same statistical analysis and the same data"

\bigskip

\large

= **long-term** and **cross-platform** reproducibility of data analyses

```{=tex}
\bigskip
\normalsize
```
 -- @Peikert2021

------------------------------------------------------------------------

```{=tex}
\centering
\Large
```
Reproducibility â‰  Replicability

\normalsize

(same analysis **new data**)

## Goals of reproducible workflows

\fontsize{14pt}{12}\selectfont

1.  **Reported** results are consistent with the **actual** results \linebreak
2.  Computational reproducibility (= hardware and software change over time)\linebreak
3.  Version control (= keep track of any changes at any time)

## Four essential tools for reproducible workflows

\Large

1.  Dynamic reports $\rightarrow$ **R Markdown** \faIcon{r-project} \linebreak
2.  Version control $\rightarrow$ **Git & Github** \faIcon{github} \linebreak
3.  Dependency management $\rightarrow$ **Make** \linebreak
4.  Containerization $\rightarrow$ **Docker** \faIcon{docker} \linebreak

## Highly versatile dynamic documents with **R Markdown**

```{r rmarkdown, echo=FALSE, out.height='75%'}

knitr::include_graphics("figures/rmarkdown_outputs.jpeg")

```

\scriptsize
https://timotheenivalis.github.io/workshops/RforRSB/rmarkdown_notes.html

## Happy knitting!

\centering

![](figures/knit-logo.png){width=1.5in}



![](figures/rmarkdownflow.png)

\footnotesize
https://rmarkdown.rstudio.com/authoring_quick_tour.html

## Git & Github 

\small

:::::::::::::: {.columns}
::: {.column}

###  \faIcon{git-alt} Git

- "Distributed version control system"
- Track and document changes ("commits")
- Retrieve older versions of code
- Enables collaboration on any kind of programming projects (scalable!)

:::
::: {.column}

<!---

\faIcon{github} Github

\vfil

--->

:::
::::::::::::::

## Git & Github 

\small

:::::::::::::: {.columns}
::: {.column}

###  \faIcon{git-alt} Git

- "Distributed version control system"
- Track and document changes ("commits")
- Retrieve older versions of code
- Enables collaboration on any kind of programming projects (scalable!)

:::
::: {.column}

###  \faIcon{github} Github

- Git repository hosting service 
- **Collaboration**:
  1. Many features for team/project management (scalable!)
  2. Report bugs/issues, get help
  3. Contribute to open-source projects
- Post-publication platform

:::
::::::::::::::

## Collaboration with Git & Github

```{r git-workflow, out.height='75%'}

knitr::include_graphics("figures/git_workflow.png")

```

\footnotesize
[How to Update a Fork in Git](https://medium.com/@sahoosunilkumar/how-to-update-a-fork-in-git-95a7daadc14e)

## \faIcon{docker} Docker 

\centering
![](figures/container.png){width=3in}

\footnotesize

# Reproducible data analysis in action

## Example analysis: How do R skills influence time to thesis completion.

\Large
\centering

**Hypothesis:** Years of experience with R are inversely correlated with the estimated time to thesis completion.

## Simulate data

```{r sample-data, echo=FALSE, results='hide'}
# load required packages
library(tidyverse)
library(finalfit)

# sample data
set.seed(1007)
n <- 30

# simulate correlated data with rnorm_multi
data <- faux::rnorm_multi(n = n,
                  vars = 2,
                  mu = c(2, 1.5),
                  sd = c(0.75, 0.5),
                  r = -0.7,
                  # empirical = FALSE,
                  varnames = c("r_exp", "thesis_compl")) %>% 
  add_column(using_r = sample(c("yes", "no"), n, replace = TRUE, prob = c(0.66,0.34)) %>% 
               factor() %>% ff_label("Using R \nfor analysis")) %>% 
  mutate(r_exp = if_else(using_r == "yes", r_exp, 0) %>% 
           ff_label("Experience \nwith R (years)"),
         thesis_compl = if_else(using_r == "yes", 
                                   true = thesis_compl - rnorm(n, 0.4, 0.2),
                                   false = thesis_compl) 
          %>% ff_label("Est. time to \nthesis completion")) %>% 
  mutate(across(where(is.numeric), ~abs(round(., digits = 2)))) %>% 
  relocate(using_r, .before = "thesis_compl")

```

\footnotesize

:::::::::::::: {.columns}
::: {.column}

### Examine data structure

```{r show-data, echo=TRUE, results='hold'}

head(data, n = 8) %>% 
  knitr::kable()
# glimpse(data)

```


:::
::: {.column}

### Data summary

\scriptsize

```{r data-overview, echo=FALSE}
data %>% 
  summary_factorlist(explanatory = c("r_exp", "thesis_compl", "using_r"),
                            add_dependent_label = TRUE) %>% 
  knitr::kable(format = "latex", booktabs = TRUE)
```



:::
::::::::::::::


## Visualize simulated data

```{r visualize-simulated, out.height='80%', fig.height=4, fig.width=7.75}

p1 <- data %>% 
  ggpubr::ggboxplot(x = "using_r", y = "thesis_compl", add = "dotplot",
                    add.params = list(size = 0.5, binwidth = 0.1), width = 0.5) +
  ggpubr::stat_compare_means(comparisons = list(c("yes", "no")),
                             method = "t.test",
                             label = "p.format") +
  labs(x = "Using R for data analysis", y = "Time to thesis completion (years)")

p2 <- data %>% 
  filter(using_r == "yes") %>% 
  ggplot(aes(x = thesis_compl, y = r_exp)) + 
  geom_point() +
  geom_smooth(method = "lm") +
  ggpubr::stat_cor(method = "pearson", label.x = 0, label.y = 0) +
  theme_classic() +
  labs(x = "Time to thesis completion (years)", 
       y = "Experience with using R (years)")


cowplot::plot_grid(p1, p2, labels = "AUTO", scale = 0.95)


```


## Get the data

link/QR code to google forms

## Run the code!

# How do I learn these tools?

## Where to start

- Reproducible research with R
- Books
- Datacamp
- Website

## Tidy data!

Links/ressources for these tools

## Session Info

\tiny

```{r}

sessionInfo()

```


## References



